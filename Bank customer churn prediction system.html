<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŠ€è¡Œå®¢æˆ¶æµå¤±é æ¸¬ç³»çµ± | AI Churn Prediction</title>
    <!-- å¼•å…¥å­—é«”èˆ‡åœ–ç¤º -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- å¼•å…¥ Chart.js ç”¨æ–¼åœ–è¡¨ç¹ªè£½ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #38bdf8;       /* äº®è—è‰² */
            --secondary: #fbbf24;     /* ç¥ç€é»ƒ */
            --bg-dark: #0f172a;       /* æ·±è—åº•è‰² */
            --bg-card: #1e293b;       /* å¡ç‰‡åº•è‰² */
            --text-main: #f1f5f9;     /* ä¸»è¦æ–‡å­— */
            --text-sub: #94a3b8;      /* æ¬¡è¦æ–‡å­— */
            --border: #334155;
            --success: #10b981;
            --danger: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            display: flex;
            min-height: 100vh;
        }

        /* å´é‚Šæ¬„ Sidebar */
        .sidebar {
            width: 260px;
            background-color: #020617;
            border-right: 1px solid var(--border);
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: fixed;
            height: 100vh;
        }

        .brand {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .menu-item {
            padding: 12px 16px;
            border-radius: 8px;
            color: var(--text-sub);
            text-decoration: none;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
        }

        .menu-item.active, .menu-item:hover {
            background-color: rgba(56, 189, 248, 0.1);
            color: var(--primary);
        }

        /* ä¸»å…§å®¹å€ Main Content */
        .main-content {
            margin-left: 260px;
            padding: 40px;
            width: 100%;
            display: grid;
            grid-template-columns: 350px 1fr; /* å·¦å´è¡¨å–®ï¼Œå³å´çµæœ */
            gap: 40px;
        }

        header {
            grid-column: 1 / -1;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-sub);
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* è¡¨å–®æ¨£å¼ */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-sub);
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            background-color: #0f172a;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
            font-family: inherit;
            outline: none;
            transition: 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
        }

        .btn-predict {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, var(--primary), #2563eb);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: 0.3s;
        }

        .btn-predict:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* çµæœé¡¯ç¤ºå€ */
        .result-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            opacity: 0.5; /* åˆå§‹ç‹€æ…‹åŠé€æ˜ */
            pointer-events: none; /* åˆå§‹ç‹€æ…‹ä¸å¯äº’å‹• */
            transition: 0.5s;
        }

        .result-container.active {
            opacity: 1;
            pointer-events: all;
        }

        .score-card {
            text-align: center;
            padding: 40px;
        }

        .probability-value {
            font-size: 64px;
            font-weight: 700;
            margin: 20px 0;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .risk-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .risk-high { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .risk-low { background: rgba(16, 185, 129, 0.2); color: var(--success); }

        /* é—œéµå› å­åˆ—è¡¨ (XAI) */
        .factors-list {
            list-style: none;
        }

        .factor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .factor-item:last-child { border-bottom: none; }

        .factor-name { font-weight: 500; }
        .factor-impact { font-size: 14px; color: var(--secondary); }
        
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 1024px) {
            .main-content { grid-template-columns: 1fr; margin-left: 0; }
            .sidebar { display: none; } /* ç°¡å–®éš±è—å´é‚Šæ¬„ä»¥é©æ‡‰æ‰‹æ©Ÿ */
        }
    </style>
</head>
<body>

    <!-- å·¦å´å°è¦½åˆ— -->
    <nav class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-layer-group"></i>
            Bank AI
        </div>
        <a href="#" class="menu-item active"><i class="fa-solid fa-chart-pie"></i> é æ¸¬å„€è¡¨æ¿</a>
        <a href="#" class="menu-item"><i class="fa-solid fa-users"></i> å®¢æˆ¶ç®¡ç†</a>
        <a href="#" class="menu-item"><i class="fa-solid fa-microchip"></i> æ¨¡å‹ç›£æ§</a>
        <a href="#" class="menu-item"><i class="fa-solid fa-gear"></i> ç³»çµ±è¨­å®š</a>
    </nav>

    <!-- ä¸»å…§å®¹å€ -->
    <main class="main-content">
        <header>
            <h1>å®¢æˆ¶æµå¤±é æ¸¬ç³»çµ±</h1>
            <p class="subtitle">è¼¸å…¥å®¢æˆ¶ç‰¹å¾µåƒæ•¸ï¼ŒAI æ¨¡å‹å°‡å³æ™‚è¨ˆç®—æµå¤±æ©Ÿç‡ (Churn Probability)ã€‚</p>
        </header>

        <!-- å·¦æ¬„ï¼šè¼¸å…¥è¡¨å–® -->
        <section class="input-section">
            <div class="card">
                <div class="card-header">
                    <i class="fa-solid fa-pen-to-square"></i> å®¢æˆ¶ç‰¹å¾µåƒæ•¸ (Features)
                </div>
                <form id="predictionForm">
                    <div class="form-group">
                        <label>ä¿¡ç”¨åˆ†æ•¸ (Credit Score)</label>
                        <input type="number" id="creditScore" placeholder="ä¾‹å¦‚: 650" value="619" min="300" max="850">
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label>åœ°ç†ä½ç½® (Geography)</label>
                            <select id="geography">
                                <option value="France">France</option>
                                <option value="Germany">Germany</option>
                                <option value="Spain">Spain</option>
                            </select>
                        </div>
                        <div>
                            <label>æ€§åˆ¥ (Gender)</label>
                            <select id="gender">
                                <option value="Female">Female</option>
                                <option value="Male">Male</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label>å¹´é½¡ (Age)</label>
                            <input type="number" id="age" value="42">
                        </div>
                        <div>
                            <label>å¾€ä¾†å¹´è³‡ (Tenure)</label>
                            <input type="number" id="tenure" value="2">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å¸³æˆ¶é¤˜é¡ (Balance)</label>
                        <input type="number" id="balance" value="0">
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label>ç”¢å“æ•¸é‡</label>
                            <select id="numOfProducts">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div>
                            <label>é ä¼°è–ªè³‡</label>
                            <input type="number" id="salary" value="101348">
                        </div>
                    </div>

                    <div class="form-group" style="display: flex; gap: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="hasCrCard" checked style="width: auto;"> æŒæœ‰ä¿¡ç”¨å¡
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="isActiveMember" checked style="width: auto;"> æ´»èºæœƒå“¡
                        </label>
                    </div>

                    <button type="button" class="btn-predict" onclick="predictChurn()">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> åŸ·è¡Œ AI é æ¸¬
                    </button>
                </form>
            </div>
        </section>

        <!-- å³æ¬„ï¼šé æ¸¬çµæœ -->
        <section class="result-container" id="resultSection">
            <!-- çµæœå¡ç‰‡ -->
            <div class="card score-card">
                <div class="card-header" style="justify-content: center; border: none;">
                    é æ¸¬çµæœ (Prediction)
                </div>
                <div id="riskBadge" class="risk-badge risk-low">ç­‰å¾…åˆ†æ...</div>
                
                <div class="probability-value" id="probValue">--%</div>
                <p style="color: var(--text-sub);">å®¢æˆ¶æµå¤±æ©Ÿç‡</p>

                <!-- Chart.js Canvas -->
                <div style="height: 200px; margin-top: 20px;">
                    <canvas id="churnChart"></canvas>
                </div>
            </div>

            <!-- å¯è§£é‡‹æ€§å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fa-solid fa-magnifying-glass-chart"></i> é—œéµå½±éŸ¿å› å­ (Explainable AI)
                </div>
                <p style="font-size: 14px; color: var(--text-sub); margin-bottom: 15px;">
                    ä»¥ä¸‹ç‰¹å¾µå°æœ¬æ¬¡é æ¸¬çµæœå½±éŸ¿æœ€å¤§ (åŸºæ–¼ SHAP å€¼æ¨¡æ“¬)ï¼š
                </p>
                <ul class="factors-list" id="factorsList">
                    <!-- Javascript å°‡å‹•æ…‹å¡«å…¥å…§å®¹ -->
                </ul>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(251, 191, 36, 0.1); border-radius: 8px; border-left: 3px solid var(--secondary);">
                    <h4 style="color: var(--secondary); margin-bottom: 5px; font-size: 14px;">ğŸ’¡ å»ºè­°æŒ½ç•™ç­–ç•¥</h4>
                    <p style="font-size: 14px; color: #cbd5e1;" id="suggestionText">
                        ç³»çµ±å»ºè­°...
                    </p>
                </div>
            </div>
        </section>
    </main>

    <script>
        // åˆå§‹åŒ– Chart.js åœ–è¡¨å¯¦ä¾‹
        let churnChartInstance = null;

        function predictChurn() {
            // 1. ç²å–è¡¨å–®æ•¸æ“š (é€™è£¡æ¨¡æ“¬å°‡æ•¸æ“šæ‰“åŒ…æˆ JSON)
            const formData = {
                creditScore: parseInt(document.getElementById('creditScore').value),
                geography: document.getElementById('geography').value,
                gender: document.getElementById('gender').value,
                age: parseInt(document.getElementById('age').value),
                balance: parseFloat(document.getElementById('balance').value),
                active: document.getElementById('isActiveMember').checked
            };

            // 2. æ¨¡æ“¬å¾Œç«¯ AI æ¨¡å‹é‚è¼¯ (Mock Logic)
            // é€™è£¡å¯«ä¸€å€‹ç°¡å–®çš„è¦å‰‡ä¾†ç”¢ç”Ÿã€Œå‡ã€çš„é æ¸¬çµæœï¼Œè®“ä»‹é¢æœ‰åæ‡‰
            let mockProbability = 0.2; // åŸºç¤æ©Ÿç‡ 20%

            // ç°¡å–®è¦å‰‡ï¼šå¹´ç´€å¤§ã€é¤˜é¡é«˜ã€å¾·åœ‹äººã€ä¸æ´»èº -> æµå¤±ç‡é«˜
            if (formData.geography === 'Germany') mockProbability += 0.15;
            if (formData.age > 50) mockProbability += 0.2;
            else if (formData.age > 40) mockProbability += 0.1;
            if (!formData.active) mockProbability += 0.15;
            if (formData.balance > 100000) mockProbability += 0.1;
            
            // ç¢ºä¿æ©Ÿç‡åœ¨ 0~1 ä¹‹é–“ (ç¨å¾®éš¨æ©ŸåŒ–ä¸€é»)
            mockProbability += (Math.random() * 0.1 - 0.05); 
            mockProbability = Math.min(Math.max(mockProbability, 0.05), 0.98);

            // 3. æ›´æ–° UI
            updateUI(mockProbability, formData);
        }

        function updateUI(probability, data) {
            const resultSection = document.getElementById('resultSection');
            const probValue = document.getElementById('probValue');
            const riskBadge = document.getElementById('riskBadge');
            const factorsList = document.getElementById('factorsList');
            const suggestionText = document.getElementById('suggestionText');

            // é¡¯ç¤ºçµæœå€å¡Š
            resultSection.classList.add('active');

            // æ ¼å¼åŒ–æ•¸å€¼
            const percentage = (probability * 100).toFixed(1);
            probValue.innerText = `${percentage}%`;

            // è¨­å®šé¢¨éšªç­‰ç´šæ¨£å¼
            if (probability > 0.5) {
                riskBadge.className = 'risk-badge risk-high';
                riskBadge.innerText = 'é«˜é¢¨éšª High Risk';
                probValue.style.background = 'linear-gradient(90deg, #f87171, #ef4444)';
                probValue.style.webkitBackgroundClip = 'text';
                
                suggestionText.innerText = "å®¢æˆ¶æµå¤±é¢¨éšªæ¥µé«˜ï¼å»ºè­°ç«‹å³æŒ‡æ´¾å°ˆå“¡è¯ç¹«ï¼Œä¸¦æä¾›ã€Œé«˜è³‡ç”¢å®¢æˆ¶å°ˆå±¬å„ªæƒ ã€æˆ–ã€Œæ‰‹çºŒè²»æ¸›å…ã€æ–¹æ¡ˆä»¥æå‡é»è‘—åº¦ã€‚";
            } else {
                riskBadge.className = 'risk-badge risk-low';
                riskBadge.innerText = 'ä½é¢¨éšª Low Risk';
                probValue.style.background = 'linear-gradient(90deg, #34d399, #10b981)';
                probValue.style.webkitBackgroundClip = 'text';

                suggestionText.innerText = "å®¢æˆ¶ç‹€æ…‹ç©©å®šã€‚å»ºè­°ç¶­æŒå®šæœŸé›»å­å ±äº’å‹•ï¼Œä¸¦æ¨è–¦é©åˆçš„ç†è²¡ç”¢å“ä»¥åŠ æ·±é—œä¿‚ã€‚";
            }

            // æ›´æ–°åœ–è¡¨ (ä½¿ç”¨ Chart.js)
            updateChart(probability);

            // æ¨¡æ“¬ XAI é—œéµå› å­ (æ ¹æ“šè¼¸å…¥ç‰¹å¾µå‹•æ…‹ç”Ÿæˆ)
            let factorsHtml = '';
            if (data.geography === 'Germany') {
                factorsHtml += `<li class="factor-item"><span class="factor-name">åœ°ç†ä½ç½® (Germany)</span> <span class="factor-impact text-danger"><i class="fa-solid fa-arrow-trend-up"></i> å¢åŠ é¢¨éšª</span></li>`;
            }
            if (data.age > 45) {
                factorsHtml += `<li class="factor-item"><span class="factor-name">å¹´é½¡ (${data.age})</span> <span class="factor-impact text-danger"><i class="fa-solid fa-arrow-trend-up"></i> å¢åŠ é¢¨éšª</span></li>`;
            }
            if (!data.active) {
                factorsHtml += `<li class="factor-item"><span class="factor-name">æ´»èºç‹€æ…‹ (Inactive)</span> <span class="factor-impact text-danger"><i class="fa-solid fa-arrow-trend-up"></i> å¢åŠ é¢¨éšª</span></li>`;
            }
            if (data.active) {
                factorsHtml += `<li class="factor-item"><span class="factor-name">æ´»èºç‹€æ…‹ (Active)</span> <span class="factor-impact" style="color:var(--success)"><i class="fa-solid fa-arrow-trend-down"></i> é™ä½é¢¨éšª</span></li>`;
            }
            
            // è£œä¸€å€‹é€šç”¨çš„
            factorsHtml += `<li class="factor-item"><span class="factor-name">æŒæœ‰ç”¢å“æ•¸</span> <span class="factor-impact" style="color:#94a3b8">å½±éŸ¿è¼•å¾®</span></li>`;

            factorsList.innerHTML = factorsHtml;
        }

        function updateChart(probability) {
            const ctx = document.getElementById('churnChart').getContext('2d');
            const remain = 1 - probability;

            if (churnChartInstance) {
                churnChartInstance.destroy();
            }

            churnChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æµå¤±æ©Ÿç‡', 'ç•™å­˜æ©Ÿç‡'],
                    datasets: [{
                        data: [probability, remain],
                        backgroundColor: [
                            probability > 0.5 ? '#ef4444' : '#10b981', // ç´…è‰²æˆ–ç¶ è‰²
                            '#334155' // æ·±ç°åº•è‰²
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%', // è®“ç”œç”œåœˆè®Šç´°
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }
    </script>
</body>
</html>

